<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Postgres Query Processing Stages &mdash; Apache AGE master documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Overview" href="../intro/overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Apache AGE
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/overview.html">Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Postgres Internals</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Postgres Query Processing Stages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parsing">Parsing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#transform-analyzer">Transform/Analyzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimizer-planner">Optimizer/Planner</a></li>
<li class="toctree-l2"><a class="reference internal" href="#execution">Execution</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Apache AGE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Postgres Query Processing Stages</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/apache/age-website/blob/master/docs/postgres/query_processing.md" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="postgres-query-processing-stages">
<h1>Postgres Query Processing Stages<a class="headerlink" href="#postgres-query-processing-stages" title="Permalink to this heading"></a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this heading"></a></h2>
<p>When a query is submitted to Postgres, the server will process the query in 5 stages.</p>
<img src='https://www.interdb.jp/pg/img/fig-3-01.png'>
</section>
<section id="parsing">
<h2>Parsing<a class="headerlink" href="#parsing" title="Permalink to this heading"></a></h2>
<p>The first stages is the parser stage. The purpose of this stage in to transform the query given to postgres from a string to adata structure that the rest of the system can understand.</p>
<p>Commonly known as an <a src='https://en.wikipedia.org/wiki/Abstract_syntax_tree'>abstract syntax tree (AST)</a> this data structed will then be passed to the rest of the system for processing. This stage does no interpretation of the query and only creates the AST and verifies that the user provided a syntatically correct query.</p>
<p>The core of the postgres phase is it’s <a src='https://github.com/postgres/postgres/blob/master/src/backend/parser/gram.y'>grammar file.</a></p>
</section>
<section id="transform-analyzer">
<h2>Transform/Analyzer<a class="headerlink" href="#transform-analyzer" title="Permalink to this heading"></a></h2>
<p>Once the parser stage is complete, the analyze phase will start. The goal of this stage is to interpret what the query is trying to do. What tables are being used, is the query a SELECT, INSERT, UPDATE, or DELETE, what data the user wants returned, etc.</p>
<p>The core of the transform phase is <a src='https://github.com/postgres/postgres/blob/master/src/backend/parser/analyze.c'>src/backend/parser/analyze.c</a>.</p>
</section>
<section id="optimizer-planner">
<h2>Optimizer/Planner<a class="headerlink" href="#optimizer-planner" title="Permalink to this heading"></a></h2>
<p>The optimizer/planner can be considered two or possibly three phases combined into one.</p>
<p>Once Postgres has figured out what the query wants to do, there is a phase where Postgres tries to optimize the query.</p>
<p>A given SQL query can be actually executed in a wide variety of different ways, each of which will produce the same set of results. If it is computationally feasible, the query optimizer will examine each of these possible execution plans, ultimately selecting the execution plan that is expected to run the fastest.</p>
<p>The entry point into the optimizer/planner is <a src='https://github.com/postgres/postgres/blob/master/src/backend/optimizer/plan/planner.c#L270'>here.</a></p>
</section>
<section id="execution">
<h2>Execution<a class="headerlink" href="#execution" title="Permalink to this heading"></a></h2>
<p>The final stage is when the query is actually executed. Once postgres has created a plan for how to execute the query, this stage will take the query and execute it.</p>
<p>The entry point for the execution phase is <a src='https://github.com/postgres/postgres/blob/master/src/backend/executor/execMain.c'>here.</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../intro/overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Apache AGE.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>